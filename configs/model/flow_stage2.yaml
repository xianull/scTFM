# @package _global_

defaults:
  - net/backbone@model.net: dit
  - _self_

model:
  _target_: src.models.flow_module.FlowLitModule
  
  # ===================================================================
  # [核心参数] 模式选择: latent (推荐) 或 raw
  # ===================================================================
  mode: latent  # "latent" 或 "raw"
  
  # Flow 模型类型: "rectified_flow" (默认), "flow_matching", "velocity_flow"
  flow_type: rectified_flow

  # 优化器
  optimizer:
    _target_: torch.optim.AdamW
    _partial_: true
    lr: 1e-4
    weight_decay: 1e-5

  # 学习率调度
  scheduler:
    _target_: torch.optim.lr_scheduler.ReduceLROnPlateau
    _partial_: true
    mode: min
    factor: 0.5
    patience: 3

# ===================================================================
# [自动配置] 根据 mode 自动调整参数
# ===================================================================

# Latent Mode (mode=latent)
# - model.net.input_dim: 64 (AE 潜在维度)
# - data.latent_key: "X_latent"
# - data.batch_size: 512 (可以更大)

# Raw Mode (mode=raw)
# - model.net.input_dim: 28231 (基因数量)
# - data.latent_key: null
# - data.batch_size: 128 (显存限制)

# ===================================================================
# 使用示例
# ===================================================================

# 1. Latent Mode (默认，推荐)
# python src/train.py model=flow_stage2 model.mode=latent

# 2. Raw Mode
# python src/train.py model=flow_stage2 model.mode=raw

# 3. 切换 Flow 类型
# python src/train.py model=flow_stage2 model.flow_type=flow_matching

# 4. 组合使用
# python src/train.py model=flow_stage2 \
#   model.mode=raw \
#   model.flow_type=velocity_flow \
#   data.batch_size=64

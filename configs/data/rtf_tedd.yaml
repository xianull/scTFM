# RTF 训练数据配置 (TEDD 数据集)

_target_: src.data.rtf_datamodule.RTFDataModule

# ===================================================================
# [核心配置] 数据路径
# ===================================================================

# 原始数据目录（TileDB-SOMA 格式，包含完整基因表达）
# 这是必须配置的基础路径
raw_data_dir: /fast/data/scTFM/rtf/TEDD/tile_4000_fix

# 实际使用的数据目录（由 train.py 根据 mode 自动设置）
# - mode=raw: data_dir = raw_data_dir
# - mode=latent: data_dir = raw_data_dir + "_latents" (自动推理)
# 注意：用户通常不需要手动设置此项
data_dir: ${data.raw_data_dir}

# [可选] 指定 latent 数据目录（不设置则自动推理为 raw_data_dir + "_latents"）
latent_dir: null

# 批次大小（根据 model.mode 自动调整）
batch_size: 256

# DataLoader 参数
num_workers: 8
pin_memory: true
persistent_workers: true
prefetch_factor: 2

# TileDB 参数
io_chunk_size: 16384

# 数据集划分
split_label_train: 0  # Train (ID)
split_label_val: 1    # Val (ID)

# 最大时间筛选（天）- 只保留该时间内的细胞，null 表示不限制
max_time_days: null

# Latent Key (根据 model.mode 自动调整)
# - latent mode: "X_latent"
# - raw mode: null
latent_key: null

# 细胞对方向
# - "forward": 使用 next_cell_id (时间正向)
# - "backward": 使用 prev_cell_id (时间逆向)
# - "both": 混合使用（数据增强）
direction: forward

# 智能负载均衡方案（由 train.py 自动注入）
shard_assignment: null

# ===================================================================
# [时间编码配置]
# ===================================================================

# Stage 信息 CSV 路径（包含 ID -> Stage 的映射）
stage_info_path: /gpfs/flash/home/jcw/projects/research/cellTime/scTFM/data/tedd_info.csv

# 是否使用 log-scale 时间归一化
# - true: 使用 log(1 + t) / log(1 + max_t)，压缩大范围同时保留早期分辨率
# - false: 使用线性归一化 t / max_t
use_log_time: true

# 高变基因列表路径 (可选)
# 如果指定，只读取该列表中的基因
gene_list_path: null


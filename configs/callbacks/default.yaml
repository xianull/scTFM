# 1. 模型检查点 (自动保存验证集 Loss 最低的模型)
model_checkpoint:
  _target_: pytorch_lightning.callbacks.ModelCheckpoint
  dirpath: ${paths.output_dir}/checkpoints
  filename: "epoch_{epoch:03d}-loss_{train/loss:.4f}"
  monitor: "train/loss"
  mode: "min"
  save_last: True      # 总是保存最后一个 epoch，方便断点续训
  save_top_k: 3        # 保存最好的 3 个模型
  auto_insert_metric_name: False

# 2. 早停机制 (如果 Loss 连续 N 个 epoch 不下降就停止)
early_stopping:
  _target_: pytorch_lightning.callbacks.EarlyStopping
  monitor: "train/loss"
  patience: 10         # 容忍 10 个 epoch 不下降
  mode: "min"

# 3. 漂亮的参数汇总表 (替代默认的 Summary)
model_summary:
  _target_: pytorch_lightning.callbacks.RichModelSummary
  max_depth: 1

# 4. 【你要的】漂亮的富文本进度条
rich_progress_bar:
  _target_: pytorch_lightning.callbacks.RichProgressBar
  theme:
    # ⬇️⬇️⬇️ 关键修复：必须显式实例化 Theme 对象 ⬇️⬇️⬇️
    _target_: pytorch_lightning.callbacks.progress.rich_progress.RichProgressBarTheme
    
    # 你的自定义颜色
    description: "green_yellow"
    progress_bar: "green1"
    progress_bar_finished: "green1"
    progress_bar_pulse: "green1"
    batch_progress: "green_yellow"
    time: "grey82"
    processing_speed: "grey82"
    metrics: "grey82"
    
    # 这样 Theme 对象会自动补全 metrics_text_delimiter 等默认参数
    # 就不需要手动写了